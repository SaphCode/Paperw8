{% extends 'base.html' %}

{% block title %}Blog{% endblock %}

{% block content %}

	<div class="container-fluid p-0 m-0 bg-light">
		<img src="{{url_for('static', filename='images/bp_banner_hq.png')}}" class="img-fluid"></img>
	</div>

	<div class="container-fluid bg-light m-0 p-0">
		<div class="d-flex justify-content-center pt-5">
			<div class="col-md-4 d-flex justify-content-center">
				<div class="btn-group d-flex justify-content-center" role="group" aria-label="Button group with nested dropdown">
					<a type="button" href="{{ url_for('blog.blog', group_by='all', sort_by=sort_by, page=1) }}" class="btn btn-sm btn-outline-dark btn-lg {% if group_by == 'all' %} active {% endif %}">All</a>
					<a type="button" href="{{ url_for('blog.blog', group_by='business', sort_by=sort_by, page=1) }}" class="btn btn-sm btn-outline-dark btn-lg {% if group_by == 'business' %} active {% endif %}" class="btn btn-outline-danger btn-lg">Businesses</a>
					<a type="button" href="{{ url_for('blog.blog', group_by='book', sort_by=sort_by, page=1) }}" class="btn btn-sm btn-outline-dark btn-lg {% if group_by == 'book' %} active {% endif %}" class="btn btn-outline-danger btn-lg">Book reviews</a>
					<a type="button" href="{{ url_for('blog.blog', group_by='annual', sort_by=sort_by, page=1) }}" class="btn btn-sm btn-outline-dark btn-lg {% if group_by == 'annual' %} active {% endif %}" class="btn btn-outline-danger btn-lg">Annual letters</a>

					<div class="btn-group" role="group">
						<button id="btnGroupDrop1" type="button" class="btn btn-sm btn-outline-dark btn-lg dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
						Sort
						</button>
						<ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
							<li><a class="dropdown-item {% if sort_by == 'date_desc' %} active {% endif %}" href="{{ url_for('blog.blog', group_by=group_by, sort_by='date_desc', page=page) }}">New to old</a></li>
							<li><a class="dropdown-item {% if sort_by == 'date_asc' %} active {% endif %}" href="{{ url_for('blog.blog', group_by=group_by, sort_by='date_asc', page=page) }}">Old to new</a></li>
							<li><a class="dropdown-item {% if sort_by == 'title_desc' %} active {% endif %}" href="{{ url_for('blog.blog', group_by=group_by, sort_by='title_desc', page=page) }}">A to Z</a></li>
							<li><a class="dropdown-item {% if sort_by == 'title_asc' %} active {% endif %}" href="{{ url_for('blog.blog', group_by=group_by, sort_by='title_asc', page=page) }}">Z to A</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>

		{% if g.user %}
		<div class="d-flex align-items-center justify-content-center pt-5">
			<div class="d-flex align-items-center justify-content-center col-md-2">
				<a type="button" class="w-100 btn btn-lg btn-primary" href="{{ url_for('blog.create') }}">Create</a>
			</div>
		</div>
		{% endif %}



	<div class="container-fluid pb-6">
		{% for post in posts %}
		<div class="row d-flex justify-content-center">
			<div class="col-md-10 d-flex justify-content-center mt-4" style="height:100%;" >

				{% if g.user['id'] == post['author_id'] or g.user['username'] == 'admin' %}
				<a class="col-md-1 text-decoration-none bg-danger d-flex justify-content-center align-items-center fw-bold me-2" href="{{ url_for('blog.update', id=post['id']) }}" style="width:5em; height:auto; color:white;">
					Edit
				</a>
				{% endif %}

				<a class="bg-white border text-decoration-none col-md-6 {{ post['category'] }} p-3 overflow-auto" href="{{ url_for('blog.post', id=post['id']) }}">
					<div class="d-inline-block mb-3 text-decoration-none fw-bold" style="color:#e03444">
						{{ post['category'].capitalize() }}
					</div>
					<div class="blog_title mb-1" style="color:black;">
						{{ post['ticker'] }}
					</div><div class="blog_title mb-1" style="color:black;">
						{{ post['title'] }}
					</div>
					<div class="mb-1 text-muted">
						<span style="color:gray">by </span>
						<span style="color:#e03444">{{ post['display_name'] }} </span>
						<span style="color:gray">on {{ post['created'].strftime('%Y-%m-%d') }}</span>
					</div>

					<div class="about font-italic">
						{% if post['created'].strftime('%Y-%m-%d') != post['last_edit'].strftime('%Y-%m-%d') %}
						<span style="color:gray">last edit on {{ post['last_edit'].strftime('%Y-%m-%d') }}</span>
						{% endif %}
					</div>
				</a>

				<a class="col-md-2 d-none d-md-none d-xl-block d-xxl-block" href="{{ url_for('blog.post', id=post['id']) }}">
					<img href="{{ url_for('blog.post', id=post['id']) }}" src="{{url_for('static', filename='images/' + post['title_img_parent_dir'] + '/' + post['title_img'])}}" style="height:200px; width:auto;"></img>
				</a>

			</div>
		</div>
		{% endfor %}
	</div>


		{% if (max_posts >= (page+1)*5) %}
		<div class="container d-flex justify-content-center bg-light mt-4 pb-6">
			<a type="button" class="btn btn-dark" href="{{ url_for('blog.blog', group_by=group_by, sort_by=sort_by, page=page+1) }}">Older Posts</a>
		</div>
		{% endif %}
	</div>

{% endblock %}
